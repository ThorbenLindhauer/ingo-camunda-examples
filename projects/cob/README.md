cob
=========================

This project has been generated by the Maven archetype
[camunda-archetype-servlet-war-7.1.3](http://docs.camunda.org/latest/guides/user-guide/#process-applications-maven-project-templates-archetypes).

Built and tested against Camunda BPM version 7.2.0.


Show me the important parts!
----------------------------


Fast Track user task
------------------------
In the process definition, the user tasks have an attached non-canceling message receive event called override. If the process instance receives an override message, it will create an additional task 'Review Override Request' for Management. In this task, the user can approve the Override and the original request and decide to publish the counterparty immediately or reject the override.

If you are interested how to do it with the Java API, check out the CounterpartyOnboardingTest.java, method overrideRequest().

To do it with the REST-API, you have to call two rest services to create the message event.

The first one: ``POST /execution`` with payload

    {
    "processVariables":
    [{"name": "aVariableName", "operator": "eq", "value": aValue}],
    "messageEventSubscriptionName": "theMessageName"}
    }

for example:

    http://localhost:8080/camunda/api/engine/engine/default/execution

with payload:

    {
    "processVariables":
    [{"name":"CPTYNumber", "operator":"eq", "value": 6}],
    "messageEventSubscriptionName": "override"}
    }  

It returns the list of executions that are expecting a message called 'override'. It is a list because there could be possibly more than one task available, if the process instance has tasks in the compliance and tax branch.

    [{"id":"885628f4-792b-11e4-b932-7ce9d3b8f4dd",
    "processInstanceId":"72516907-792b-11e4-b932-7ce9d3b8f4dd",
    "ended":false},
    {"id":"8856c53c-792b-11e4-b932-7ce9d3b8f4dd",
    "processInstanceId":"72516907-792b-11e4-b932-7ce9d3b8f4dd",
    "ended":false}]

Then you can get the first executionId from the list and use it in the second rest call to send this task the message with the payload: ``POST /execution/{id}/messageSubscriptions/{messageName}/trigger``

for example:

    http://localhost:8080/camunda/api/engine/engine/default/execution/885628f4-792b-11e4-b932-7ce9d3b8f4dd/messageSubscriptions/override/trigger
    
with payload:

    {"variables":
    {"overrideReason" : {"value": "I want to trade with this counterparty today"}}
    }

After this call the task 'review override request' can be found in the tasklist of management.

Ad Hoc Approval Task
--------------------

To make an other person approve a request instantly, there are several possible ways.

### Approval in the following task

In this process, if the COB-User wants an instant approval by the tax team, he enters the reason on the form, checks the instant approval and the process will go directly to the 'check for tax rules' task. The tax team can enter some comments and can give it back to the COB to amend the request. After amending the process instance will instantiate the tax 'check for tax rules' again to review the amended data.

How to use it?
--------------

There is no web interface to access the application.
To get started refer to the `InMemoryH2Test`.

You can also use `ant` to build and deploy the example to an application server.
For that to work you need to copy the file `build.properties.example` to `build.properties`
and configure the path to your application server inside it.
Alternatively, you can also copy it to `${user.home}/.camunda/build.properties`
to have a central configuration that works with all projects generated by the
[Camunda BPM Maven Archetypes](http://docs.camunda.org/latest/guides/user-guide/#process-applications-maven-project-templates-archetypes).

Once you deployed the application you can run it using
[Camunda Tasklist](http://docs.camunda.org/latest/guides/user-guide/#tasklist)
and inspect it using
[Camunda Cockpit](http://docs.camunda.org/latest/guides/user-guide/#cockpit).


Environment Restrictions
------------------------

Built and tested against Camunda BPM version 7.2.0.


Improvements Backlog
--------------------

